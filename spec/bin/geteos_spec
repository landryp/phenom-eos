#!/usr/bin/python
__doc__ = 'GETEOS_SPEC -- save EoS data for specified spectral EoS'
__usage__ = 'geteos'
__author__ = 'philippe.landry@ligo.org'
__date__ = '10-2018'

import numpy as np
from optparse import OptionParser
from get_spec import spec

parser = OptionParser(usage=__usage__, description=__doc__)
parser.add_option('-n', '--num', default=100, help='number of EoS data pts to return, DEFAULT=100', metavar='num')
parser.add_option('-o', '--outpath', default='./dat/', help='path to output data, DEFAULT="../dat/"', metavar='outpath')
parser.add_option('-i', '--inpath', default='./in/', help='path to input parameters, DEFAULT="../in/"', metavar='inpath')
parser.add_option('-p', '--paramsfile', default='specparams.in', help='name of piecewise polytrope parameters input file, DEFAULT="specparams.in"', metavar='paramsfile')
parser.add_option('-x', '--xmax', default=1e1, help='log maximum pressure to return (in units of crust-core interface enthalpy), DEFAULT=10', metavar='xmax')
parser.add_option('-t', '--tag', default='', help='tag for output data file, DEFAULT=""', metavar='tag')

opts, args = parser.parse_args()
outpath = str(opts.outpath)
inpath = str(opts.inpath)
paramsfile = str(opts.paramsfile)
tag = str(opts.tag)
num = float(opts.num)
xmax = float(opts.xmax)

outfile1 = open(outpath+"eos/"+"spec_"+tag+".csv","w")
outfile2 = open(outpath+"params/"+"params_"+tag+".csv","w")

specparams = np.genfromtxt(inpath+paramsfile,delimiter=',',names=True)

g0, g1, g2, g3 = [specparams['gamma0'],specparams['gamma1'],specparams['gamma2'],specparams['gamma3']]
rhodat, mudat, pdat = spec(g0, g1, g2, g3, num, xmax)

outfile1.write('logpressurec2,pressurec2,energy_densityc2,baryon_density \n')
outfile2.write('gamma0,gamma1,gamma2,gamma3 \n')
outfile2.write('{0},{1},{2},{3} \n'.format(g0,g1,g2,g3))

for i in range(len(rhodat)):

	p = pdat[i]
	logp = np.log(p)
	mu = mudat[i]
	rho = rhodat[i]

	outfile1.write('{0},{1},{2},{3} \n'.format(logp,p,mu,rho))
